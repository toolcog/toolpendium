{
  "name": "verifyRequestWithPSD2",
  "description": "Use Verify request to generate and send a PIN to your user to authorize a payment:\n1. Create a request to send a verification code to your user.\n2. Check the `status` field in the response to ensure that your request was successful (zero is success).\n3. Use the `request_id` field in the response for the Verify check.\n(Please note that XML format is not supported for the Payment Services Directive endpoint at this time.)",
  "parameters": {
    "type": "object",
    "properties": {
      "format": {
        "enum": [
          "json",
          "xml"
        ],
        "type": "string",
        "description": "The response format."
      },
      "body": {
        "$ref": "#/$defs/psd2Request"
      }
    },
    "required": [
      "format",
      "body"
    ],
    "$defs": {
      "psd2Request": {
        "properties": {
          "amount": {
            "description": "The decimal amount of the payment to be confirmed, in Euros",
            "example": "48.00",
            "format": "float",
            "type": "number"
          },
          "api_key": {
            "$ref": "#/$defs/api_key"
          },
          "api_secret": {
            "$ref": "#/$defs/api_secret"
          },
          "code_length": {
            "default": 4,
            "description": "The length of the verification code.",
            "enum": [
              4,
              6
            ],
            "example": 6,
            "type": "integer"
          },
          "country": {
            "description": "If you do not provide `number` in international format or you are not sure if `number` is correctly formatted, specify the two-character country code in `country`. Verify will then format the number for you.",
            "example": "GB",
            "type": "string"
          },
          "lg": {
            "default": "en-gb",
            "description": "By default, the SMS or text-to-speech (TTS) message is generated in the locale that matches the `number`. For example, the text message or TTS message for a `33*` number is sent in French. Use this parameter to explicitly control the language used.\n*Note: Voice calls in English for `bg-bg`, `ee-et`, `ga-ie`, `lv-lv`, `lt-lt`, `mt-mt`, `sk-sk`, `sk-si`",
            "enum": [
              "en-gb",
              "bg-bg",
              "cs-cz",
              "da-dk",
              "de-de",
              "ee-et",
              "el-gr",
              "es-es",
              "fi-fi",
              "fr-fr",
              "ga-ie",
              "hu-hu",
              "it-it",
              "lv-lv",
              "lt-lt",
              "mt-mt",
              "nl-nl",
              "pl-pl",
              "sk-sk",
              "sl-si",
              "sv-se"
            ],
            "example": "es-es",
            "type": "string"
          },
          "next_event_wait": {
            "default": 300,
            "description": "Specifies the wait time in seconds between attempts to deliver the verification code.",
            "example": 120,
            "maximum": 900,
            "minimum": 60,
            "type": "integer"
          },
          "number": {
            "description": "The mobile or landline phone number to verify. Unless you are setting `country` explicitly, this number must be in [E.164](https://en.wikipedia.org/wiki/E.164) format.",
            "example": "447700900000",
            "type": "string"
          },
          "payee": {
            "description": "An alphanumeric string to indicate to the user the name of the recipient that they are confirming a payment to.",
            "example": "Acme Inc",
            "maxLength": 18,
            "type": "string"
          },
          "pin_expiry": {
            "default": 300,
            "description": "How long the generated verification code is valid for, in seconds. When you specify both `pin_expiry` and `next_event_wait` then `pin_expiry` must be an integer multiple of `next_event_wait` otherwise `pin_expiry` is defaulted to equal next_event_wait. See [changing the event timings](https://developer.nexmo.com/verify/guides/changing-default-timings).",
            "example": 240,
            "maximum": 3600,
            "minimum": 60,
            "type": "integer"
          },
          "workflow_id": {
            "default": 1,
            "description": "Selects the predefined sequence of SMS and TTS (Text To Speech) actions to use in order to convey the PIN to your user. For example, an id of 1 identifies the workflow SMS - TTS - TTS. For a list of all workflows and their associated ids, please visit the [developer portal](https://developer.nexmo.com/verify/guides/workflows-and-events).",
            "enum": [
              1,
              2,
              3,
              4,
              5,
              6,
              7
            ],
            "example": 4,
            "type": "integer"
          }
        },
        "required": [
          "api_key",
          "api_secret",
          "number",
          "payee",
          "amount"
        ],
        "type": "object"
      },
      "api_key": {
        "description": "You can find your API key in your [account dashboard](https://dashboard.nexmo.com)",
        "example": "abcd1234",
        "type": "string"
      },
      "api_secret": {
        "description": "You can find your API secret in your [account dashboard](https://dashboard.nexmo.com)",
        "example": "Sup3rS3cr3t!!",
        "type": "string"
      }
    }
  },
  "handler": "http",
  "request": {
    "method": "POST",
    "url": {
      "$uri": "https://api.nexmo.com/verify/psd2/{format}"
    },
    "body": {
      "$": "body",
      "encode": "urlencoded"
    }
  },
  "responses": {
    "200": {
      "$encode": "markdown",
      "$lang": "json",
      "$code": {
        "$encode": "json",
        "$indent": true,
        "$content": {
          "$": "$.body"
        }
      }
    }
  }
}
