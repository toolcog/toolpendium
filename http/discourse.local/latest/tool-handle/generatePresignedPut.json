{
  "name": "generatePresignedPut",
  "description": "Direct external uploads bypass the usual method of creating uploads\nvia the POST /uploads route, and upload directly to an external provider,\nwhich by default is S3. This route begins the process, and will return\na unique identifier for the external upload as well as a presigned URL\nwhich is where the file binary blob should be uploaded to.\n\nOnce the upload is complete to the external service, you must call the\nPOST /complete-external-upload route using the unique identifier returned\nby this route, which will create any required Upload record in the Discourse\ndatabase and also move file from its temporary location to the final\ndestination in the external storage service.\n\nYou must have the correct permissions and CORS settings configured in your\nexternal provider. We support AWS S3 as the default. See:\n\nhttps://meta.discourse.org/t/-/210469#s3-multipart-direct-uploads-4.\n\nAn external file store must be set up and `enable_direct_s3_uploads` must\nbe set to true for this endpoint to function.\n\n",
  "parameters": {
    "type": "object",
    "properties": {
      "body": {
        "additionalProperties": false,
        "properties": {
          "file_name": {
            "examples": [
              "IMG_2021.jpeg"
            ],
            "type": "string"
          },
          "file_size": {
            "description": "File size should be represented in bytes.",
            "examples": [
              4096
            ],
            "type": "integer"
          },
          "metadata": {
            "additionalProperties": false,
            "properties": {
              "sha1-checksum": {
                "description": "The SHA1 checksum of the upload binary blob. Optionally\nbe provided and serves as an additional security check when\nlater processing the file in complete-external-upload endpoint.",
                "type": "string"
              }
            },
            "type": "object"
          },
          "type": {
            "enum": [
              "avatar",
              "profile_background",
              "card_background",
              "custom_emoji",
              "composer"
            ],
            "type": "string"
          }
        },
        "required": [
          "type",
          "file_name",
          "file_size"
        ]
      }
    }
  },
  "handler": "http",
  "request": {
    "method": "POST",
    "url": {
      "$uri": "http://discourse.local/uploads/generate-presigned-put.json"
    },
    "body": {
      "$": "body",
      "encode": "json"
    }
  },
  "responses": {
    "200": {
      "$encode": "markdown",
      "$block": [
        {
          "$h1": "Object"
        },
        "**Key properties:**",
        {
          "$ul": [
            "**key**: The path of the temporary file on the external storage",
            "**unique_identifier**: A unique string that identifies the external upload.",
            "**url**: A presigned PUT URL which must be used to upload"
          ]
        },
        {
          "$lang": "json",
          "$code": {
            "$encode": "json",
            "$indent": true,
            "$content": {
              "$": "$.body"
            }
          }
        }
      ]
    }
  }
}
