{
  "name": "completeExternalUpload",
  "description": "Completes an external upload initialized with /get-presigned-put. The\nfile will be moved from its temporary location in external storage to\na final destination in the S3 bucket. An Upload record will also be\ncreated in the database in most cases.\n\nIf a sha1-checksum was provided in the initial request it will also\nbe compared with the uploaded file in storage to make sure the same\nfile was uploaded. The file size will be compared for the same reason.\n\nYou must have the correct permissions and CORS settings configured in your\nexternal provider. We support AWS S3 as the default. See:\n\nhttps://meta.discourse.org/t/-/210469#s3-multipart-direct-uploads-4.\n\nAn external file store must be set up and `enable_direct_s3_uploads` must\nbe set to true for this endpoint to function.\n\n",
  "parameters": {
    "type": "object",
    "properties": {
      "body": {
        "additionalProperties": false,
        "properties": {
          "for_private_message": {
            "description": "Optionally set this to true if the upload is for a\nprivate message.",
            "examples": [
              "true"
            ],
            "type": "string"
          },
          "for_site_setting": {
            "description": "Optionally set this to true if the upload is for a\nsite setting.",
            "examples": [
              "true"
            ],
            "type": "string"
          },
          "pasted": {
            "description": "Optionally set this to true if the upload was pasted\ninto the upload area. This will convert PNG files to JPEG.",
            "examples": [
              "true"
            ],
            "type": "string"
          },
          "unique_identifier": {
            "description": "The unique identifier returned in the original /generate-presigned-put\nrequest.",
            "examples": [
              "66e86218-80d9-4bda-b4d5-2b6def968705"
            ],
            "type": "string"
          }
        },
        "required": [
          "unique_identifier"
        ]
      }
    }
  },
  "handler": "http",
  "request": {
    "method": "POST",
    "url": {
      "$uri": "http://discourse.local/uploads/complete-external-upload.json"
    },
    "body": {
      "$": "body",
      "encode": "json"
    }
  },
  "responses": {
    "200": {
      "$encode": "markdown",
      "$block": [
        {
          "$h1": "Object"
        },
        "**Key properties:**",
        {
          "$ul": [
            "**dominant_color**",
            "**extension**",
            "**filesize**",
            "**height**",
            "**human_filesize**",
            "**id**",
            "**original_filename**",
            "**retain_hours**",
            "**short_path**",
            "**short_url**",
            "**thumbnail_height**",
            "**thumbnail_width**",
            "**url**",
            "**width**"
          ]
        },
        {
          "$lang": "json",
          "$code": {
            "$encode": "json",
            "$indent": true,
            "$content": {
              "$": "$.body"
            }
          }
        }
      ]
    }
  }
}
