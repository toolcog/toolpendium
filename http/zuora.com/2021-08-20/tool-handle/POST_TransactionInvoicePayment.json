{
  "name": "POST_TransactionInvoicePayment",
  "description": "Generates and posts invoices and credit memos and collects payments for posted invoices. Credit memos are only available if you have the Invoice Settlement feature enabled and negative charges exist. Credit memos will not be applied to invoices. If draft invoices and credit memos exist when you run this operation, this operation will post the invoices and credit memos. Note that draft credit memos created from an invoice or a product rate plan charge will not be posted.\n\nYou can use this operation to generate invoices and collect payments on the posted invoices,\n or else simply collect payment on a specified existing\ninvoice. The customer's default payment method is used, and the full\namount due is collected. The operation depends on the parameters you\nspecify.\n\n- To generate one or more new invoices for that customer and collect\npayment on the generated and other unpaid invoice(s), leave the **invoiceId** field empty. \n\n- To collect payment on an existing invoice, specify the invoice ID. \n\n\nThe operation is atomic; if any part is unsuccessful, the entire\noperation is rolled back.\n\nWhen an error occurs, gateway reason codes and error messages are returned the error response of this operation. The following items are some gateway response code examples.\n\n- Orbital: `05 Do Not Honor`; `14 Invalid Credit Card Number`\n- Vantiv: `301 Invalid Account Number`; `304 Lost/Stolen Card`  \n- CyberSource2: `202 Expired card`; `231 Invalid account number`\n\nFor more reason code information, see the corresponding payment gateway documentation. \n\n\n## Notes\n\nTimeouts may occur when using this method on an account that\nhas an extremely high number of subscriptions.\n",
  "parameters": {
    "type": "object",
    "properties": {
      "Zuora-Track-Id": {
        "maxLength": 64,
        "type": "string",
        "description": "A custom identifier for tracing the API call. If you set a value for this header, Zuora returns the same value in the response headers. This header enables you to associate your system process identifiers with Zuora API calls, to assist with troubleshooting in the event of an issue.\n\nThe value of this field must use the US-ASCII character set and must not include any of the following characters: colon (`:`), semicolon (`;`), double quote (`\"`), and quote (`'`).\n"
      },
      "Zuora-Entity-Ids": {
        "type": "string",
        "description": "An entity ID. If you have [Zuora Multi-entity](https://knowledgecenter.zuora.com/BB_Introducing_Z_Business/Multi-entity) enabled and the OAuth token is valid for more than one entity, you must use this header to specify which entity to perform the operation in. If the OAuth token is only valid for a single entity, or you do not have Zuora Multi-entity enabled, you do not need to set this header.\n"
      },
      "zuora-version": {
        "type": "string",
        "description": "\nThe minor version of the Zuora REST API. \n\nYou need to set this parameter if you use the following fields:\n* documentDate\n* targetDate            \n\nIf you have the Invoice Settlement feature enabled, you need to specify this parameter. Otherwise, an error is returned.\n\n\nSee [Zuora REST API Versions](https://www.zuora.com/developer/api-reference/#section/API-Versions) for more information.\n"
      }
    }
  },
  "handler": "http",
  "request": {
    "method": "POST",
    "url": {
      "$uri": "https://rest.zuora.com/v1/operations/invoice-collect"
    },
    "headers": {
      "Zuora-Track-Id": {
        "$": "Zuora-Track-Id"
      },
      "Zuora-Entity-Ids": {
        "$": "Zuora-Entity-Ids"
      },
      "zuora-version": {
        "$": "zuora-version"
      }
    }
  },
  "responses": {
    "200": {
      "$encode": "markdown",
      "$block": [
        {
          "$h1": "Object"
        },
        "**Key properties:**",
        {
          "$ul": [
            "**amountCollected**: Payment amount applied.",
            "**creditMemos**: Information on one or more credit memos associated with this operation.",
            "**invoices**: Information on one or more invoices associated with this operation.",
            "**paymentId**: Payment ID.",
            "**success**: Returns `true` if the request was processed successfully."
          ]
        },
        {
          "$lang": "json",
          "$code": {
            "$encode": "json",
            "$indent": true,
            "$content": {
              "$": "$.body"
            }
          }
        }
      ]
    }
  }
}
