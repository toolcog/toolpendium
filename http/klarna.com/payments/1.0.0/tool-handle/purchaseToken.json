{
  "name": "purchaseToken",
  "description": "Use this API call to create a Klarna Customer Token.<br/>After having obtained an `authorization_token` for a successful authorization, this can be used to create a purchase token instead of placing the order. Creating a Klarna Customer Token results in Klarna storing customer and payment method details.\nRead more on **[Generate a consumer token](https://docs.klarna.com/klarna-payments/in-depth-knowledge/customer-token/)**.",
  "parameters": {
    "type": "object",
    "properties": {
      "authorizationToken": {
        "type": "string"
      },
      "body": {
        "$ref": "#/$defs/customer_token_creation_request"
      }
    },
    "required": [
      "authorizationToken"
    ],
    "$defs": {
      "customer_token_creation_request": {
        "properties": {
          "billing_address": {
            "$ref": "#/$defs/address"
          },
          "customer": {
            "$ref": "#/$defs/customer"
          },
          "description": {
            "description": "Description of the purpose of the token.",
            "maxLength": 255,
            "type": "string"
          },
          "intended_use": {
            "description": "Intended use for the token.",
            "enum": [
              "SUBSCRIPTION"
            ],
            "type": "string"
          },
          "locale": {
            "description": "RFC 1766 customer's locale.",
            "example": "en-GB",
            "pattern": "^[A-Za-z]{2,2}(?:-[A-Za-z]{2,2})*$",
            "type": "string"
          },
          "purchase_country": {
            "description": "ISO 3166 alpha-2 purchase country.",
            "example": "GB",
            "pattern": "^[A-Za-z]{2,2}$",
            "type": "string"
          },
          "purchase_currency": {
            "description": "ISO 4217 purchase currency.",
            "example": "GBP",
            "pattern": "^[A-Za-z]{3,3}$",
            "type": "string"
          }
        },
        "required": [
          "description",
          "intended_use",
          "locale",
          "purchase_country",
          "purchase_currency"
        ],
        "type": "object"
      },
      "address": {
        "properties": {
          "attention": {
            "description": "‘Attn.’ (if applicable). Only applicable for B2B customers.",
            "example": "Attn",
            "maxLength": 99,
            "minLength": 0,
            "type": "string"
          },
          "city": {
            "description": "Customer’s city.",
            "example": "London",
            "maxLength": 99,
            "minLength": 0,
            "type": "string"
          },
          "country": {
            "description": "Customer’s country. This value overrides the purchase country if they are different. Should follow the standard of ISO 3166 alpha-2. E.g. GB, US, DE, SE.",
            "example": "GB",
            "pattern": "^[A-Za-z]{2,2}$",
            "type": "string"
          },
          "email": {
            "description": "Customer’s email address.",
            "example": "test.sam@test.com",
            "maxLength": 99,
            "minLength": 0,
            "type": "string"
          },
          "family_name": {
            "description": "Customers family name in UTF-8 encoding.\nCannot be only numbers, must be more than 1 character.\nAllowed special characters: -'’.\nMore information can be found [in this link](https://docs.klarna.com/klarna-payments/in-depth-knowledge/customer-data-requirements/#details-needed-per-market)",
            "example": "Andersson",
            "maxLength": 99,
            "minLength": 0,
            "type": "string"
          },
          "given_name": {
            "description": "Customers given name in UTF-8 encoding.\nCannot be only numbers, must be more than 1 character.\nAllowed special characters: -'’.\nMore information can be found [in this link](https://docs.klarna.com/klarna-payments/in-depth-knowledge/customer-data-requirements/#details-needed-per-market)",
            "example": "Adam",
            "maxLength": 99,
            "minLength": 0,
            "type": "string"
          },
          "organization_name": {
            "description": "Organization name (if applicable). Only applicable for B2B customers.",
            "maxLength": 99,
            "minLength": 0,
            "type": "string"
          },
          "phone": {
            "description": "Phone number. Preferably a mobile phone number.",
            "example": "+44795465131",
            "maxLength": 99,
            "minLength": 5,
            "type": "string"
          },
          "postal_code": {
            "description": "Customer’s postal code. Validation according to Universal Postal Union addressing systems.\nE.g. 12345, W1G OPW.",
            "example": "W1G 0PW",
            "maxLength": 10,
            "minLength": 0,
            "type": "string"
          },
          "region": {
            "description": "Customer’s region or state - Mandatory for US and AU market. Validations according to ISO 3166-2 format, e.g. OH, NJ, etc.",
            "example": "OH",
            "maxLength": 99,
            "minLength": 0,
            "type": "string"
          },
          "street_address": {
            "description": "Customer’s street address. Regional formatting is required, as follows:\nUK/US/FR: 33 Cavendish Square\nRest of EU: De Ruijterkade 7",
            "example": "33 Cavendish Square",
            "maxLength": 99,
            "minLength": 0,
            "type": "string"
          },
          "street_address2": {
            "description": "Customer’s street address. Second Line. ",
            "example": "Floor 22 / Flat 2",
            "maxLength": 99,
            "minLength": 0,
            "type": "string"
          },
          "title": {
            "description": "Customer’s Title. Allowed values per country:\nUK - \"Mr\", \"Ms\"\nDE - \"Herr\", \"Frau\"\nAT: \"Herr, \"Frau\"\nCH: de-CH: \"Herr, \"Frau\" it-CH: \"Sig.\", \"Sig.ra\" fr-CH: \"M\", \"Mme\" \nBE: \"Dhr.\", \"Mevr.\"\nNL: \"Dhr.\", \"Mevr.\"",
            "example": "Mr.",
            "maxLength": 20,
            "minLength": 0,
            "type": "string"
          }
        },
        "type": "object"
      },
      "customer": {
        "properties": {
          "date_of_birth": {
            "description": "Customer’s date of birth. The format is ‘yyyy-mm-dd’",
            "example": "1978-12-31",
            "type": "string"
          },
          "gender": {
            "description": "Customer’s gender - ‘male’ or ‘female’",
            "example": "male",
            "type": "string"
          },
          "last_four_ssn": {
            "description": "Last four digits of the customer's social security number. This value is available for US customers.",
            "pattern": "^([0-9]{4}|[0-9]{9})$",
            "type": "string"
          },
          "national_identification_number": {
            "description": "The customer's national identification number. This value is available for EU customers utilizing national identification numbers.",
            "type": "string"
          },
          "organization_entity_type": {
            "description": "Organization entity type. Only applicable for B2B customers.",
            "enum": [
              "LIMITED_COMPANY",
              "PUBLIC_LIMITED_COMPANY",
              "ENTREPRENEURIAL_COMPANY",
              "LIMITED_PARTNERSHIP_LIMITED_COMPANY",
              "LIMITED_PARTNERSHIP",
              "GENERAL_PARTNERSHIP",
              "REGISTERED_SOLE_TRADER",
              "SOLE_TRADER",
              "CIVIL_LAW_PARTNERSHIP",
              "PUBLIC_INSTITUTION",
              "OTHER"
            ],
            "type": "string"
          },
          "organization_registration_id": {
            "description": "Organization registration id. Only applicable for B2B customers.",
            "type": "string"
          },
          "title": {
            "description": "Customer’s Title. Allowed values per country:\nUK - \"Mr\", \"Ms\"\nDE - \"Herr\", \"Frau\"\nAT: \"Herr, \"Frau\"\nCH: de-CH: \"Herr, \"Frau\" it-CH: \"Sig.\", \"Sig.ra\" fr-CH: \"M\", \"Mme\" \nBE: \"Dhr.\", \"Mevr.\"\nNL: \"Dhr.\", \"Mevr.\"",
            "example": "Mr.",
            "type": "string"
          },
          "type": {
            "description": "Type of customer in the session. If nothing is added, a B2C session will be the default. If it is a b2b-session, you should enter organization to trigger a B2B session.",
            "example": "organization",
            "pattern": "^(person|organization)$",
            "type": "string"
          },
          "vat_id": {
            "description": "VAT ID. Only applicable for B2B customers.",
            "type": "string"
          }
        },
        "type": "object"
      }
    }
  },
  "handler": "http",
  "request": {
    "method": "POST",
    "url": {
      "$uri": "https://api.klarna.com/payments/v1/authorizations/{authorizationToken}/customer-token"
    },
    "body": {
      "$": "body",
      "encode": "json"
    }
  },
  "responses": {
    "200": {
      "$encode": "markdown",
      "$block": [
        {
          "$h1": "Object"
        },
        "**Key properties:**",
        {
          "$ul": [
            [
              "**billing_address**",
              {
                "$ul": [
                  "**attention**: ‘Attn.’ (if applicable). Only applicable for B2B customers.",
                  "**city**: Customer’s city.",
                  "**country**: Customer’s country. This value overrides the purchase country if they are different. Should follow the standard of ISO 3166 alpha-2. E.g. GB, US, DE, SE.",
                  "**email**: Customer’s email address.",
                  "**family_name**: Customers family name in UTF-8 encoding.",
                  "**given_name**: Customers given name in UTF-8 encoding.",
                  "**organization_name**: Organization name (if applicable). Only applicable for B2B customers.",
                  "**phone**: Phone number. Preferably a mobile phone number.",
                  "**postal_code**: Customer’s postal code. Validation according to Universal Postal Union addressing systems.",
                  "**region**: Customer’s region or state - Mandatory for US and AU market. Validations according to ISO 3166-2 format, e.g. OH, NJ, etc.",
                  "**street_address**: Customer’s street address. Regional formatting is required, as follows:",
                  "**street_address2**: Customer’s street address. Second Line. ",
                  "**title**: Customer’s Title. Allowed values per country:"
                ]
              }
            ],
            [
              "**customer**",
              {
                "$ul": [
                  "**date_of_birth**: Customer’s date of birth. The format is ‘yyyy-mm-dd’",
                  "**gender**: Customer’s gender - ‘male’ or ‘female’"
                ]
              }
            ],
            "**payment_method_reference**: Used to connect customers with payment method when it is present.",
            "**redirect_url**: URL to redirect the customer to after placing the order. This is a Klarna URL where Klarna will place a cookie in the customer’s browser (if redirected) and redirect the customer back to the confirmation URL provided by the merchant. This is not a mandatory step but a recommended one to improve the returning customer’s experience.",
            "**token_id**: Generated customer token. This token will be used to create a new order for the subscription using the Create a New order using token API."
          ]
        },
        {
          "$lang": "json",
          "$code": {
            "$encode": "json",
            "$indent": true,
            "$content": {
              "$": "$.body"
            }
          }
        }
      ]
    },
    "400": {
      "$encode": "markdown",
      "$block": [
        {
          "$h1": "Object"
        },
        "**Key properties:**",
        {
          "$ul": [
            [
              "**authorized_payment_method**",
              {
                "$ul": [
                  "**number_of_days**",
                  "**number_of_installments**",
                  "**type**"
                ]
              }
            ],
            "**correlation_id**",
            "**error_code**",
            "**error_messages**",
            "**fraud_status**",
            "**reason**"
          ]
        },
        {
          "$lang": "json",
          "$code": {
            "$encode": "json",
            "$indent": true,
            "$content": {
              "$": "$.body"
            }
          }
        }
      ]
    }
  }
}
