{
  "name": "fulfillment-simulation",
  "description": "This endpoint may be called upon by VTEX for fulfillment simulation in the external seller different contexts. See examples below.\n\nWhen a [price](https://developers.vtex.com/docs/api-reference/marketplace-apis#post-/notificator/-sellerId-/changenotification/-skuId-/price) or [inventory](https://developers.vtex.com/docs/api-reference/marketplace-apis#post-/notificator/-sellerId-/changenotification/-skuId-/inventory) notification request returns a response with status `200 OK`, it means that the SKU already exists in the marketplace. Whenever this happens, the marketplace will call the seller to get two updated information about the SKU: Price and Inventory.\n\nThe seller needs to have an endpoint implemented in order to receive this call and send a response containing the requested information to the marketplace. We call it the Fulfillment Simulation endpoint.\n\nIf the seller wishes to include other parameters in this call (like account name, or [sales channel](https://help.vtex.com/en/tutorial/como-funciona-uma-politica-comercial--6Xef8PZiFm40kg2STrMkMV) ID), this should be done within their {fulfillmentEndpoint}. This path is then inserted in the marketplace's VTEX admin when [configuring a seller](https://help.vtex.com/en/tutorial/configurando-seller--tutorials_392). \n\nThe marketplace will send an object containing an array of items. The seller must use this list to get the updated information about the referred SKUs and send them back to the marketplace, following the response format explained in the API Reference. \n\nThis call is also applied in the Storefront simulation scenario, in which case the request from VTEX does not send the paramenters `country` and `postalCode`. \nThe call's payload can be adapted into two scenarios: \n\n- **Displaying items in the storefront**: the address information can be nulled in the request, since they are not mandatory data for this context.   \n- **Making a shopping cart simulation during checkout**: address information must be sent, since this data is needed to calculate freight values. If the address information (including `postalCode` and `country`) is not sent through the call, VTEX interprets the stock balance as zero. Without a valid stock balance, the seller will not be shown as an option during checkout. \n  \n## Request body example - Indexing simulation\n\n```\n{\n    \"items\": [\n      {\n        \"id\": \"7908010136043\",\n        \"quantity\": 1,\n        \"seller\": \"1\",\n      }\n    ],\n    \"isCheckedIn\": false,\n  }\n``` \n## Request body example - Checkout simulation\n\n```\n{\n    \"items\": [\n      {\n        \"id\": \"7908010136043\",\n        \"quantity\": 1,\n        \"seller\": \"1\",\n      }\n    ],\n    \"postalCode\": \"22270-030\",\n    \"country\": \"BRA\",\n  }\n```",
  "parameters": {
    "type": "object",
    "properties": {
      "fulfillmentEndpoint": {
        "example": "marketplaceexample.externalseller.com",
        "type": "string",
        "description": "This is the fulfillment endpoint registered for each specific external seller in the **seller management** section of VTEX's admin panel."
      },
      "Accept": {
        "example": "application/json",
        "type": "string",
        "description": "HTTP Client Negotiation _Accept_ Header. Indicates the types of responses the client can understand."
      },
      "Content-Type": {
        "example": "application/json",
        "type": "string",
        "description": "Describes the type of the content being sent."
      },
      "body": {
        "properties": {
          "country": {
            "description": "ISO 3-digit code of the country where the delivery address is located.  This field is mandatory, for shopping carts simulations, where both Country and Postal Code are required. This field should be sent as `null` for storefront simulations, where the information is not necessary.",
            "example": "USA",
            "type": "string"
          },
          "geoCoordinates": {
            "description": "Geographic coordinates of the delivery address. This may be used instead of the postalCode, in case the marketplace is configured to accept geolocation. Example of value: `[-22.9443504,-43.1825635]`.",
            "items": {
              "example": "00.00000000",
              "type": "string"
            },
            "type": "array"
          },
          "items": {
            "description": "Array containing the cart items.",
            "items": {
              "$ref": "#/$defs/fulfillmentItem"
            },
            "type": "array"
          },
          "postalCode": {
            "description": "Delivery address postal code. This field is mandatory for shopping carts simulations, where both Country and Postal Code are required. This field should be sent as `null` for storefront simulations, where the information is not necessary.",
            "example": "12345678",
            "type": "string"
          },
          "sc": {
            "description": "Sales channel (or [trade policy](https://help.vtex.com/en/tutorial/como-funciona-uma-politica-comercial--6Xef8PZiFm40kg2STrMkMV#master-data)) associated to the seller account created.",
            "example": "1",
            "type": "string"
          }
        },
        "required": [
          "postalCode"
        ],
        "type": "object",
        "description": ""
      }
    },
    "required": [
      "fulfillmentEndpoint",
      "Accept",
      "Content-Type",
      "body"
    ],
    "$defs": {
      "fulfillmentItem": {
        "properties": {
          "id": {
            "description": "SKU ID.",
            "example": "6",
            "type": "string"
          },
          "quantity": {
            "description": "Quantity of items of the SKU in the cart.",
            "example": 1,
            "type": "integer"
          },
          "seller": {
            "description": "ID of the seller registered in VTEX.",
            "example": "01",
            "type": "string"
          }
        },
        "required": [
          "id",
          "quantity",
          "seller"
        ],
        "type": "object"
      }
    }
  },
  "handler": "http",
  "request": {
    "method": "POST",
    "url": {
      "$uri": "https://vtex.local/{fulfillmentEndpoint}/pvt/orderForms/simulation"
    },
    "headers": {
      "Accept": {
        "$": "Accept"
      },
      "Content-Type": {
        "$": "Content-Type"
      }
    },
    "body": {
      "$": "body",
      "encode": "json"
    }
  },
  "responses": {
    "200": {
      "$encode": "markdown",
      "$block": [
        {
          "$h1": "Response body"
        },
        "Expected response body of fulfillment simulation",
        "**Key properties:**",
        {
          "$ul": [
            "**country**: ISO 3-digit code of the country where the delivery address is located. If you donâ€™t want to send it, use the value null.",
            "**items**: Contains the data about each SKU in the cart.",
            "**logisticsInfo**: Array that contains the data regarding the delivery methods and stock for each item. If all products are unavailable, this field should return empty.",
            "**postalCode**: Postal code of the delivery address. This field is mandatory, for shopping carts simulations, where both Country and Postal Code are required. This field should be sent as `null` for storefront simulations, where the information is not necessary."
          ]
        },
        {
          "$lang": "json",
          "$code": {
            "$encode": "json",
            "$indent": true,
            "$content": {
              "$": "$.body"
            }
          }
        }
      ]
    }
  }
}
