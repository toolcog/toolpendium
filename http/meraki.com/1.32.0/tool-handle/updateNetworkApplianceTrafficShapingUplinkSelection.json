{
  "name": "updateNetworkApplianceTrafficShapingUplinkSelection",
  "description": "Update uplink selection settings for an MX network",
  "parameters": {
    "type": "object",
    "properties": {
      "networkId": {
        "type": "string"
      },
      "body": {
        "example": {
          "activeActiveAutoVpnEnabled": true,
          "defaultUplink": "wan1",
          "failoverAndFailback": {
            "immediate": {
              "enabled": true
            }
          },
          "loadBalancingEnabled": true,
          "vpnTrafficUplinkPreferences": [
            {
              "failOverCriterion": "poorPerformance",
              "performanceClass": {
                "builtinPerformanceClassName": "VoIP",
                "customPerformanceClassId": "123456",
                "type": "custom"
              },
              "preferredUplink": "bestForVoIP",
              "trafficFilters": [
                {
                  "type": "applicationCategory",
                  "value": {
                    "destination": {
                      "cidr": "any",
                      "fqdn": "www.google.com",
                      "host": 254,
                      "network": "L_12345678",
                      "port": "1-1024",
                      "vlan": 10
                    },
                    "id": "meraki:layer7/category/1",
                    "protocol": "tcp",
                    "source": {
                      "cidr": "192.168.1.0/24",
                      "host": 200,
                      "network": "L_23456789",
                      "port": "any",
                      "vlan": 20
                    }
                  }
                }
              ]
            }
          ],
          "wanTrafficUplinkPreferences": [
            {
              "preferredUplink": "wan1",
              "trafficFilters": [
                {
                  "type": "custom",
                  "value": {
                    "destination": {
                      "cidr": "any",
                      "port": "any"
                    },
                    "protocol": "tcp",
                    "source": {
                      "cidr": "192.168.1.0/24",
                      "host": 254,
                      "port": "1-1024",
                      "vlan": 10
                    }
                  }
                }
              ]
            }
          ]
        },
        "properties": {
          "activeActiveAutoVpnEnabled": {
            "description": "Toggle for enabling or disabling active-active AutoVPN",
            "type": "boolean"
          },
          "defaultUplink": {
            "description": "The default uplink. Must be one of: 'wan1' or 'wan2'",
            "enum": [
              "wan1",
              "wan2"
            ],
            "type": "string"
          },
          "failoverAndFailback": {
            "description": "WAN failover and failback behavior",
            "properties": {
              "immediate": {
                "description": "Immediate WAN transition terminates all flows (new and existing) on current WAN when it is deemed unreliable.",
                "properties": {
                  "enabled": {
                    "description": "Toggle for enabling or disabling immediate WAN failover and failback",
                    "type": "boolean"
                  }
                },
                "required": [
                  "enabled"
                ],
                "type": "object"
              }
            },
            "type": "object"
          },
          "loadBalancingEnabled": {
            "description": "Toggle for enabling or disabling load balancing",
            "type": "boolean"
          },
          "vpnTrafficUplinkPreferences": {
            "description": "Array of uplink preference rules for VPN traffic",
            "items": {
              "properties": {
                "failOverCriterion": {
                  "description": "Fail over criterion for this uplink preference rule. Must be one of: 'poorPerformance' or 'uplinkDown'",
                  "enum": [
                    "poorPerformance",
                    "uplinkDown"
                  ],
                  "type": "string"
                },
                "performanceClass": {
                  "description": "Performance class setting for this uplink preference rule",
                  "properties": {
                    "builtinPerformanceClassName": {
                      "description": "Name of builtin performance class, must be present when performanceClass type is 'builtin', and value must be one of: 'VoIP'",
                      "enum": [
                        "VoIP"
                      ],
                      "type": "string"
                    },
                    "customPerformanceClassId": {
                      "description": "ID of created custom performance class, must be present when performanceClass type is 'custom'",
                      "type": "string"
                    },
                    "type": {
                      "description": "Type of this performance class. Must be one of: 'builtin' or 'custom'",
                      "enum": [
                        "builtin",
                        "custom"
                      ],
                      "type": "string"
                    }
                  },
                  "required": [
                    "type"
                  ],
                  "type": "object"
                },
                "preferredUplink": {
                  "description": "Preferred uplink for this uplink preference rule. Must be one of: 'wan1', 'wan2', 'bestForVoIP', 'loadBalancing' or 'defaultUplink'",
                  "enum": [
                    "bestForVoIP",
                    "defaultUplink",
                    "loadBalancing",
                    "wan1",
                    "wan2"
                  ],
                  "type": "string"
                },
                "trafficFilters": {
                  "description": "Array of traffic filters for this uplink preference rule",
                  "items": {
                    "properties": {
                      "type": {
                        "description": "Type of this traffic filter. Must be one of: 'applicationCategory', 'application' or 'custom'",
                        "enum": [
                          "application",
                          "applicationCategory",
                          "custom"
                        ],
                        "type": "string"
                      },
                      "value": {
                        "description": "Value object of this traffic filter",
                        "properties": {
                          "destination": {
                            "description": "Destination of this custom type traffic filter",
                            "properties": {
                              "cidr": {
                                "description": "CIDR format address, or \"any\". E.g.: \"192.168.10.0/24\",  \"192.168.10.1\" (same as \"192.168.10.1/32\"), \"0.0.0.0/0\" (same as \"any\")",
                                "type": "string"
                              },
                              "fqdn": {
                                "description": "FQDN format address. Currently only availabe in 'destination' of 'vpnTrafficUplinkPreference' object. E.g.: 'www.google.com'",
                                "type": "string"
                              },
                              "host": {
                                "description": "Host ID in the VLAN, should be used along with 'vlan', and not exceed the vlan subnet capacity. Currently only available under a template network.",
                                "type": "integer"
                              },
                              "network": {
                                "description": "Meraki network ID. Currently only available under a template network, and the value should be ID of either same template network, or another template network currently. E.g.: \"L_12345678\".",
                                "type": "string"
                              },
                              "port": {
                                "description": "E.g.: \"any\", \"0\" (also means \"any\"), \"8080\", \"1-1024\"",
                                "type": "string"
                              },
                              "vlan": {
                                "description": "VLAN ID of the configured VLAN in the Meraki network. Currently only available under a template network.",
                                "type": "integer"
                              }
                            },
                            "type": "object"
                          },
                          "id": {
                            "description": "ID of this applicationCategory or application type traffic filter. E.g.: \"meraki:layer7/category/1\", \"meraki:layer7/application/4\"",
                            "type": "string"
                          },
                          "protocol": {
                            "description": "Protocol of this custom type traffic filter. Must be one of: 'tcp', 'udp', 'icmp', 'icmp6' or 'any'",
                            "enum": [
                              "any",
                              "icmp",
                              "icmp6",
                              "tcp",
                              "udp"
                            ],
                            "type": "string"
                          },
                          "source": {
                            "description": "Source of this custom type traffic filter",
                            "properties": {
                              "cidr": {
                                "description": "CIDR format address, or \"any\". E.g.: \"192.168.10.0/24\",  \"192.168.10.1\" (same as \"192.168.10.1/32\"), \"0.0.0.0/0\" (same as \"any\")",
                                "type": "string"
                              },
                              "host": {
                                "description": "Host ID in the VLAN, should be used along with 'vlan', and not exceed the vlan subnet capacity. Currently only available under a template network.",
                                "type": "integer"
                              },
                              "network": {
                                "description": "Meraki network ID. Currently only available under a template network, and the value should be ID of either same template network, or another template network currently. E.g.: \"L_12345678\".",
                                "type": "string"
                              },
                              "port": {
                                "description": "E.g.: \"any\", \"0\" (also means \"any\"), \"8080\", \"1-1024\"",
                                "type": "string"
                              },
                              "vlan": {
                                "description": "VLAN ID of the configured VLAN in the Meraki network. Currently only available under a template network.",
                                "type": "integer"
                              }
                            },
                            "type": "object"
                          }
                        },
                        "type": "object"
                      }
                    },
                    "required": [
                      "type",
                      "value"
                    ],
                    "type": "object"
                  },
                  "type": "array"
                }
              },
              "required": [
                "trafficFilters",
                "preferredUplink"
              ],
              "type": "object"
            },
            "type": "array"
          },
          "wanTrafficUplinkPreferences": {
            "description": "Array of uplink preference rules for WAN traffic",
            "items": {
              "properties": {
                "preferredUplink": {
                  "description": "Preferred uplink for this uplink preference rule. Must be one of: 'wan1' or 'wan2'",
                  "enum": [
                    "wan1",
                    "wan2"
                  ],
                  "type": "string"
                },
                "trafficFilters": {
                  "description": "Array of traffic filters for this uplink preference rule",
                  "items": {
                    "properties": {
                      "type": {
                        "description": "Type of this traffic filter. Must be one of: 'custom'",
                        "enum": [
                          "custom"
                        ],
                        "type": "string"
                      },
                      "value": {
                        "description": "Value object of this traffic filter",
                        "properties": {
                          "destination": {
                            "description": "Destination of this custom type traffic filter",
                            "properties": {
                              "cidr": {
                                "description": "CIDR format address, or \"any\". E.g.: \"192.168.10.0/24\",  \"192.168.10.1\" (same as \"192.168.10.1/32\"), \"0.0.0.0/0\" (same as \"any\")",
                                "type": "string"
                              },
                              "port": {
                                "description": "E.g.: \"any\", \"0\" (also means \"any\"), \"8080\", \"1-1024\"",
                                "type": "string"
                              }
                            },
                            "type": "object"
                          },
                          "protocol": {
                            "description": "Protocol of this custom type traffic filter. Must be one of: 'tcp', 'udp', 'icmp6' or 'any'",
                            "enum": [
                              "any",
                              "icmp6",
                              "tcp",
                              "udp"
                            ],
                            "type": "string"
                          },
                          "source": {
                            "description": "Source of this custom type traffic filter",
                            "properties": {
                              "cidr": {
                                "description": "CIDR format address, or \"any\". E.g.: \"192.168.10.0/24\",  \"192.168.10.1\" (same as \"192.168.10.1/32\"), \"0.0.0.0/0\" (same as \"any\")",
                                "type": "string"
                              },
                              "host": {
                                "description": "Host ID in the VLAN, should be used along with 'vlan', and not exceed the vlan subnet capacity. Currently only available under a template network.",
                                "type": "integer"
                              },
                              "port": {
                                "description": "E.g.: \"any\", \"0\" (also means \"any\"), \"8080\", \"1-1024\"",
                                "type": "string"
                              },
                              "vlan": {
                                "description": "VLAN ID of the configured VLAN in the Meraki network. Currently only available under a template network.",
                                "type": "integer"
                              }
                            },
                            "type": "object"
                          }
                        },
                        "required": [
                          "source",
                          "destination"
                        ],
                        "type": "object"
                      }
                    },
                    "required": [
                      "type",
                      "value"
                    ],
                    "type": "object"
                  },
                  "type": "array"
                }
              },
              "required": [
                "trafficFilters",
                "preferredUplink"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "type": "object"
      }
    },
    "required": [
      "networkId"
    ]
  },
  "handler": "http",
  "request": {
    "method": "PUT",
    "url": {
      "$uri": "https://api.meraki.com/api/v1/networks/{networkId}/appliance/trafficShaping/uplinkSelection"
    },
    "body": {
      "$": "body",
      "encode": "json"
    }
  },
  "responses": {
    "200": {
      "$encode": "markdown",
      "$block": [
        {
          "$h1": "Object"
        },
        "**Key properties:**",
        {
          "$ul": [
            "**activeActiveAutoVpnEnabled**: Whether active-active AutoVPN is enabled",
            "**defaultUplink**: The default uplink. Must be one of: 'wan1' or 'wan2'",
            [
              "**failoverAndFailback**: WAN failover and failback",
              {
                "$ul": [
                  [
                    "**immediate**: Immediate WAN failover and failback",
                    {
                      "$ul": [
                        "**enabled**: Whether immediate WAN failover and failback is enabled"
                      ]
                    }
                  ]
                ]
              }
            ],
            "**loadBalancingEnabled**: Whether load balancing is enabled",
            "**vpnTrafficUplinkPreferences**: Uplink preference rules for VPN traffic",
            "**wanTrafficUplinkPreferences**: Uplink preference rules for WAN traffic"
          ]
        },
        {
          "$lang": "json",
          "$code": {
            "$encode": "json",
            "$indent": true,
            "$content": {
              "$": "$.body"
            }
          }
        }
      ]
    }
  }
}
